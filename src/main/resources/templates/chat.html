<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Spring Chat</title>
  <style>
    body { font-family: system-ui, sans-serif; background:#f5f5f5; }
    .wrap { max-width: 900px; margin: 30px auto; background:#fff;
            border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,.08);
            display:flex; flex-direction:column; height: 85vh; }
    header { padding:16px; border-bottom:1px solid #eee; font-weight:600; }
    #messages { flex:1; overflow:auto; padding:18px; }
    .msg { margin:10px 0; line-height:1.45; white-space:pre-wrap; }
    .user { text-align:right; color:#0b57d0; }
    .assistant { text-align:left; color:#222; }
    .composer { border-top:1px solid #eee; padding:12px; display:flex; gap:10px; }
    input { flex:1; padding:10px; font-size:16px; }
    button { padding:10px 14px; font-size:16px; cursor:pointer; }
  </style>
</head>

<body>
<div class="wrap">
  <header>Spring Chat</header>

  <div id="messages"></div>

  <div class="composer">
    <input id="messageInput" type="text" placeholder="Type your messageâ€¦"
           onkeydown="if(event.key==='Enter') sendMessage()">
    <button onclick="sendMessage()">Send</button>
  </div>
</div>

<script>
  function appendMessage(role, text) {
    const messages = document.getElementById("messages");
    const div = document.createElement("div");
    div.className = "msg " + role;
    div.textContent = text;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
    return div; // IMPORTANT
  }

  async function sendMessage() {
    const input = document.getElementById("messageInput");
    const text = input.value.trim();
    if (!text) return;
    appendMessage("user", text);
    input.value = "";
    // Create placeholder and KEEP reference
    const assistantDiv = appendMessage("assistant", "Thinkingâ€¦");
    const resp = await fetch("/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message: text })
    });
    if (!resp.ok) {
      assistantDiv.textContent = "Error: HTTP " + resp.status;
      return;
    }
    const answer = await resp.text();
    // ðŸ”¥ REPLACE placeholder content
    assistantDiv.textContent = answer;
  }
</script>
</body>
</html>